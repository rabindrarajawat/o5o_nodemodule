{"ast":null,"code":"import assert from '../../../utils/assert.mjs';\nimport { toDateTime, toOptionDateTime } from '../../../types/DateTime.mjs';\nimport { amount, lamports } from '../../../types/Amount.mjs';\nimport { Pda } from '../../../types/Pda.mjs';\nimport { toBigNumber } from '../../../types/BigNumber.mjs';\n/** @group Models */\n\n/** @group Model Helpers */\n\nconst isBid = value => typeof value === 'object' && value.model === 'bid' && !value.lazy;\n/** @group Model Helpers */\n\n\nfunction assertBid(value) {\n  assert(isBid(value), `Expected Bid type`);\n}\n/** @group Model Helpers */\n\n\nconst toBid = (account, auctionHouse, asset) => {\n  const lazyBid = toLazyBid(account, auctionHouse);\n  return { ...lazyBid,\n    model: 'bid',\n    lazy: false,\n    ...('token' in asset ? {\n      asset,\n      tokens: amount(lazyBid.tokens, asset.mint.currency),\n      isPublic: false\n    } : {\n      asset,\n      tokens: amount(lazyBid.tokens, asset.mint.currency),\n      isPublic: true\n    })\n  };\n};\n/** @group Models */\n\n/** @group Model Helpers */\n\n\nconst isPrivateBid = value => typeof value === 'object' && value.model === 'bid' && !value.isPublic;\n/** @group Model Helpers */\n\n\nconst isLazyBid = value => typeof value === 'object' && value.model === 'bid' && value.lazy;\n/** @group Model Helpers */\n\n\nfunction assertLazyBid(value) {\n  assert(isLazyBid(value), `Expected LazyBid type`);\n}\n/** @group Model Helpers */\n\n\nconst toLazyBid = (account, auctionHouse) => {\n  return {\n    model: 'bid',\n    lazy: true,\n    auctionHouse,\n    tradeStateAddress: new Pda(account.data.tradeState, account.data.tradeStateBump),\n    bookkeeperAddress: account.data.bookkeeper,\n    buyerAddress: account.data.buyer,\n    metadataAddress: account.data.metadata,\n    tokenAddress: account.data.tokenAccount,\n    receiptAddress: new Pda(account.publicKey, account.data.bump),\n    purchaseReceiptAddress: account.data.purchaseReceipt,\n    isPublic: Boolean(account.data.tokenAccount),\n    // Data.\n    price: auctionHouse.isNative ? lamports(account.data.price) : amount(account.data.price, auctionHouse.treasuryMint.currency),\n    tokens: toBigNumber(account.data.tokenSize),\n    createdAt: toDateTime(account.data.createdAt),\n    canceledAt: toOptionDateTime(account.data.canceledAt)\n  };\n};\n\nexport { assertBid, assertLazyBid, isBid, isLazyBid, isPrivateBid, toBid, toLazyBid };","map":{"version":3,"sources":["../../../../../src/plugins/auctionHouseModule/models/Bid.ts"],"names":["isBid","value","model","lazy","assertBid","assert","toBid","account","auctionHouse","asset","lazyBid","toLazyBid","tokens","amount","mint","currency","isPublic","isPrivateBid","isLazyBid","assertLazyBid","tradeStateAddress","Pda","data","tradeState","tradeStateBump","bookkeeperAddress","bookkeeper","buyerAddress","buyer","metadataAddress","metadata","tokenAddress","tokenAccount","receiptAddress","publicKey","bump","purchaseReceiptAddress","purchaseReceipt","Boolean","price","isNative","lamports","treasuryMint","toBigNumber","tokenSize","createdAt","toDateTime","canceledAt","toOptionDateTime"],"mappings":"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","sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { BidReceiptAccount } from '../accounts';\nimport { Nft, NftWithToken, Sft, SftWithToken } from '../../nftModule';\nimport { AuctionHouse } from './AuctionHouse';\nimport {\n  amount,\n  BigNumber,\n  DateTime,\n  lamports,\n  Pda,\n  SolAmount,\n  SplTokenAmount,\n  toBigNumber,\n  toDateTime,\n  toOptionDateTime,\n} from '@/types';\nimport { assert, Option } from '@/utils';\n\n/** @group Models */\nexport type Bid = Readonly<\n  {\n    /** A model identifier to distinguish models in the SDK. */\n    model: 'bid';\n\n    /**\n     * Whether or not the asset was loaded.\n     * When this is `false`, it means the Bid includes asset model.\n     */\n    lazy: false;\n\n    /** A model of the Auction House related to this bid. */\n    auctionHouse: AuctionHouse;\n\n    /** The address of the buyer's trade state account. */\n    tradeStateAddress: Pda;\n\n    /** The address of the buyer's wallet. */\n    buyerAddress: PublicKey;\n\n    /**\n     * The address of the bookkeeper account.\n     * It is responsible for signing a Bid Receipt Print.\n     */\n    bookkeeperAddress: Option<PublicKey>;\n\n    /**\n     * The address of the bid receipt account.\n     * This is the account that stores information about this bid.\n     * The Bid model is built on top of this account.\n     */\n    receiptAddress: Option<Pda>;\n\n    /**\n     * The address of the purchase receipt account.\n     * This is the account that stores information about the purchase related to this bid.\n     *\n     * ```ts\n     * const transactionBuilder = metaplex\n     *   .auctionHouse()\n     *   .builders()\n     *   .findPurchaseByReceipt({ auctionHouse, receiptAddress: purchaseReceiptAddress });\n     * ```\n     */\n    purchaseReceiptAddress: Option<PublicKey>;\n\n    /** The buyer's price. */\n    price: SolAmount | SplTokenAmount;\n\n    /** The number of tokens bid is for. */\n    tokens: SplTokenAmount;\n\n    /** The date of creation. */\n    createdAt: DateTime;\n\n    /** The date of cancellation. */\n    canceledAt: Option<DateTime>;\n  } & (\n    | {\n        /** The bid is not public, which means that it was created according to the listing. */\n        isPublic: false;\n\n        /** The Nft or Sft with the associated token account. */\n        asset: SftWithToken | NftWithToken;\n      }\n    | {\n        /**\n         * The bid is public.\n         * This means that a bid can stay active beyond the end of an auction\n         * and be resolved if it meets the criteria for subsequent auctions of that token.\n         */\n        isPublic: true;\n\n        /** The Nft or Sft related to the Bid. */\n        asset: Sft | Nft;\n      }\n  )\n>;\n\n/** @group Model Helpers */\nexport const isBid = (value: any): value is Bid =>\n  typeof value === 'object' && value.model === 'bid' && !value.lazy;\n\n/** @group Model Helpers */\nexport function assertBid(value: any): asserts value is Bid {\n  assert(isBid(value), `Expected Bid type`);\n}\n\n/** @group Model Helpers */\nexport const toBid = (\n  account: BidReceiptAccount,\n  auctionHouse: AuctionHouse,\n  asset: Nft | Sft | NftWithToken | SftWithToken\n): Bid => {\n  const lazyBid = toLazyBid(account, auctionHouse);\n\n  return {\n    ...lazyBid,\n    model: 'bid',\n    lazy: false,\n    ...('token' in asset\n      ? {\n          asset,\n          tokens: amount(lazyBid.tokens, asset.mint.currency),\n          isPublic: false,\n        }\n      : {\n          asset,\n          tokens: amount(lazyBid.tokens, asset.mint.currency),\n          isPublic: true,\n        }),\n  };\n};\n\n/** @group Models */\nexport type PublicBid = Bid & { isPublic: true; asset: Sft | Nft };\n\n/** @group Models */\nexport type PrivateBid = Bid & {\n  isPublic: false;\n  asset: SftWithToken | NftWithToken;\n};\n\n/** @group Model Helpers */\nexport const isPrivateBid = (value: any): value is PrivateBid =>\n  typeof value === 'object' && value.model === 'bid' && !value.isPublic;\n\nexport type LazyBid = Omit<Bid, 'lazy' | 'asset' | 'tokens'> &\n  Readonly<{\n    lazy: true;\n    metadataAddress: PublicKey;\n    tokenAddress: Option<PublicKey>;\n    tokens: BigNumber;\n  }>;\n\n/** @group Model Helpers */\nexport const isLazyBid = (value: any): value is LazyBid =>\n  typeof value === 'object' && value.model === 'bid' && value.lazy;\n\n/** @group Model Helpers */\nexport function assertLazyBid(value: any): asserts value is LazyBid {\n  assert(isLazyBid(value), `Expected LazyBid type`);\n}\n\n/** @group Model Helpers */\nexport const toLazyBid = (\n  account: BidReceiptAccount,\n  auctionHouse: AuctionHouse\n): LazyBid => {\n  return {\n    model: 'bid',\n    lazy: true,\n    auctionHouse,\n    tradeStateAddress: new Pda(\n      account.data.tradeState,\n      account.data.tradeStateBump\n    ),\n    bookkeeperAddress: account.data.bookkeeper,\n    buyerAddress: account.data.buyer,\n    metadataAddress: account.data.metadata,\n    tokenAddress: account.data.tokenAccount,\n    receiptAddress: new Pda(account.publicKey, account.data.bump),\n    purchaseReceiptAddress: account.data.purchaseReceipt,\n    isPublic: Boolean(account.data.tokenAccount),\n\n    // Data.\n    price: auctionHouse.isNative\n      ? lamports(account.data.price)\n      : amount(account.data.price, auctionHouse.treasuryMint.currency),\n    tokens: toBigNumber(account.data.tokenSize),\n    createdAt: toDateTime(account.data.createdAt),\n    canceledAt: toOptionDateTime(account.data.canceledAt),\n  };\n};\n"]},"metadata":{},"sourceType":"module"}