{"ast":null,"code":"import { Buffer } from 'buffer';\nimport { PROGRAM_ID, Key } from '@metaplex-foundation/mpl-token-metadata';\nimport { padEmptyChars } from '../../utils/common.mjs';\nimport { GpaBuilder } from '../../utils/GpaBuilder.mjs';\nimport { toBigNumber } from '../../types/BigNumber.mjs';\nconst MAX_NAME_LENGTH = 32;\nconst MAX_SYMBOL_LENGTH = 10;\nconst MAX_URI_LENGTH = 200;\nconst MAX_CREATOR_LEN = 32 + 1 + 1;\nconst DATA_START = 1 + 32 + 32;\nconst NAME_START = DATA_START + 4;\nconst SYMBOL_START = NAME_START + MAX_NAME_LENGTH + 4;\nconst URI_START = SYMBOL_START + MAX_SYMBOL_LENGTH + 4;\nconst CREATORS_START = URI_START + MAX_URI_LENGTH + 2 + 1 + 4;\n\nclass TokenMetadataGpaBuilder extends GpaBuilder {\n  constructor(metaplex, programId) {\n    super(metaplex, programId ?? PROGRAM_ID);\n  }\n\n  whereKey(key) {\n    return this.where(0, toBigNumber(key, 'le'));\n  }\n\n}\n\nclass MetadataV1GpaBuilder extends TokenMetadataGpaBuilder {\n  constructor(metaplex, programId) {\n    super(metaplex, programId);\n    this.whereKey(Key.MetadataV1);\n  }\n\n  selectUpdatedAuthority() {\n    return this.slice(1, 32);\n  }\n\n  whereUpdateAuthority(updateAuthority) {\n    return this.where(1, updateAuthority);\n  }\n\n  selectMint() {\n    return this.slice(33, 32);\n  }\n\n  whereMint(mint) {\n    return this.where(33, mint);\n  }\n\n  selectName() {\n    return this.slice(NAME_START, MAX_NAME_LENGTH);\n  }\n\n  whereName(name) {\n    return this.where(NAME_START, Buffer.from(padEmptyChars(name, MAX_NAME_LENGTH)));\n  }\n\n  selectSymbol() {\n    return this.slice(SYMBOL_START, MAX_SYMBOL_LENGTH);\n  }\n\n  whereSymbol(symbol) {\n    return this.where(SYMBOL_START, Buffer.from(padEmptyChars(symbol, MAX_SYMBOL_LENGTH)));\n  }\n\n  selectUri() {\n    return this.slice(URI_START, MAX_URI_LENGTH);\n  }\n\n  whereUri(uri) {\n    return this.where(URI_START, Buffer.from(padEmptyChars(uri, MAX_URI_LENGTH)));\n  }\n\n  selectCreator(position) {\n    return this.slice(CREATORS_START + (position - 1) * MAX_CREATOR_LEN, CREATORS_START + position * MAX_CREATOR_LEN);\n  }\n\n  whereCreator(position, creator) {\n    return this.where(CREATORS_START + (position - 1) * MAX_CREATOR_LEN, creator);\n  }\n\n  selectFirstCreator() {\n    return this.selectCreator(1);\n  }\n\n  whereFirstCreator(firstCreator) {\n    return this.whereCreator(1, firstCreator);\n  }\n\n}\n\nexport { MetadataV1GpaBuilder, TokenMetadataGpaBuilder };","map":{"version":3,"sources":["../../../../src/plugins/nftModule/gpaBuilders.ts"],"names":["MAX_NAME_LENGTH","MAX_SYMBOL_LENGTH","MAX_URI_LENGTH","MAX_CREATOR_LEN","DATA_START","NAME_START","SYMBOL_START","URI_START","CREATORS_START","TokenMetadataGpaBuilder","GpaBuilder","constructor","metaplex","programId","PROGRAM_ID","whereKey","key","where","toBigNumber","MetadataV1GpaBuilder","Key","MetadataV1","selectUpdatedAuthority","slice","whereUpdateAuthority","updateAuthority","selectMint","whereMint","mint","selectName","whereName","name","Buffer","from","padEmptyChars","selectSymbol","whereSymbol","symbol","selectUri","whereUri","uri","selectCreator","position","whereCreator","creator","selectFirstCreator","whereFirstCreator","firstCreator"],"mappings":"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","sourcesContent":["import { Buffer } from 'buffer';\nimport { PublicKey } from '@solana/web3.js';\nimport { Key, PROGRAM_ID } from '@metaplex-foundation/mpl-token-metadata';\nimport { Metaplex } from '@/Metaplex';\nimport { GpaBuilder, padEmptyChars } from '@/utils';\nimport { toBigNumber } from '@/types';\n\nconst MAX_NAME_LENGTH = 32;\nconst MAX_SYMBOL_LENGTH = 10;\nconst MAX_URI_LENGTH = 200;\nconst MAX_CREATOR_LEN = 32 + 1 + 1;\nconst DATA_START = 1 + 32 + 32;\nconst NAME_START = DATA_START + 4;\nconst SYMBOL_START = NAME_START + MAX_NAME_LENGTH + 4;\nconst URI_START = SYMBOL_START + MAX_SYMBOL_LENGTH + 4;\nconst CREATORS_START = URI_START + MAX_URI_LENGTH + 2 + 1 + 4;\n\nexport class TokenMetadataGpaBuilder extends GpaBuilder {\n  constructor(metaplex: Metaplex, programId?: PublicKey) {\n    super(metaplex, programId ?? PROGRAM_ID);\n  }\n\n  whereKey(key: Key) {\n    return this.where(0, toBigNumber(key, 'le'));\n  }\n}\n\nexport class MetadataV1GpaBuilder extends TokenMetadataGpaBuilder {\n  constructor(metaplex: Metaplex, programId?: PublicKey) {\n    super(metaplex, programId);\n    this.whereKey(Key.MetadataV1);\n  }\n\n  selectUpdatedAuthority() {\n    return this.slice(1, 32);\n  }\n\n  whereUpdateAuthority(updateAuthority: PublicKey) {\n    return this.where(1, updateAuthority);\n  }\n\n  selectMint() {\n    return this.slice(33, 32);\n  }\n\n  whereMint(mint: PublicKey) {\n    return this.where(33, mint);\n  }\n\n  selectName() {\n    return this.slice(NAME_START, MAX_NAME_LENGTH);\n  }\n\n  whereName(name: string) {\n    return this.where(\n      NAME_START,\n      Buffer.from(padEmptyChars(name, MAX_NAME_LENGTH))\n    );\n  }\n\n  selectSymbol() {\n    return this.slice(SYMBOL_START, MAX_SYMBOL_LENGTH);\n  }\n\n  whereSymbol(symbol: string) {\n    return this.where(\n      SYMBOL_START,\n      Buffer.from(padEmptyChars(symbol, MAX_SYMBOL_LENGTH))\n    );\n  }\n\n  selectUri() {\n    return this.slice(URI_START, MAX_URI_LENGTH);\n  }\n\n  whereUri(uri: string) {\n    return this.where(\n      URI_START,\n      Buffer.from(padEmptyChars(uri, MAX_URI_LENGTH))\n    );\n  }\n\n  selectCreator(position: number) {\n    return this.slice(\n      CREATORS_START + (position - 1) * MAX_CREATOR_LEN,\n      CREATORS_START + position * MAX_CREATOR_LEN\n    );\n  }\n\n  whereCreator(position: number, creator: PublicKey) {\n    return this.where(\n      CREATORS_START + (position - 1) * MAX_CREATOR_LEN,\n      creator\n    );\n  }\n\n  selectFirstCreator() {\n    return this.selectCreator(1);\n  }\n\n  whereFirstCreator(firstCreator: PublicKey) {\n    return this.whereCreator(1, firstCreator);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}