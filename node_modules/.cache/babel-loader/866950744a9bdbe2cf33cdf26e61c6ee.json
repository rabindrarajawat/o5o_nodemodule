{"ast":null,"code":"import { BEET_PACKAGE, BEET_TYPE_ARG_LEN } from '../types';\nimport { strict as assert } from 'assert';\nimport { u32 } from './numbers';\nimport { logTrace } from '../utils';\n/**\n * De/Serializes a UTF8 string of a particular size.\n *\n * @param stringByteLength the number of bytes of the string\n *\n * @category beet/collection\n */\n\nexport const fixedSizeUtf8String = stringByteLength => {\n  return {\n    write: function (buf, offset, value) {\n      const stringBuf = Buffer.from(value, 'utf8');\n      assert.equal(stringBuf.byteLength, stringByteLength, `${value} has invalid byte size`);\n      u32.write(buf, offset, stringByteLength);\n      stringBuf.copy(buf, offset + 4, 0, stringByteLength);\n    },\n    read: function (buf, offset) {\n      const size = u32.read(buf, offset);\n      assert.equal(size, stringByteLength, `invalid byte size`);\n      const stringSlice = buf.slice(offset + 4, offset + 4 + stringByteLength);\n      return stringSlice.toString('utf8');\n    },\n    elementByteSize: 1,\n    length: stringByteLength,\n    lenPrefixByteSize: 4,\n    byteSize: 4 + stringByteLength,\n    description: `Utf8String(4 + ${stringByteLength})`\n  };\n};\n/**\n * De/Serializes a UTF8 string of any size.\n *\n * @category beet/collection\n */\n\nexport const utf8String = {\n  toFixedFromData(buf, offset) {\n    const len = u32.read(buf, offset);\n    logTrace(`${this.description}[${len}]`);\n    return fixedSizeUtf8String(len);\n  },\n\n  toFixedFromValue(val) {\n    const len = Buffer.from(val).byteLength;\n    return fixedSizeUtf8String(len);\n  },\n\n  description: `Utf8String`\n};\n/**\n * Maps string beet exports to metadata which describes in which package it\n * is defined as well as which TypeScript type is used to represent the\n * deserialized value in JavaScript.\n *\n * @category TypeDefinition\n */\n\nexport const stringTypeMap = {\n  fixedSizeString: {\n    beet: 'fixedSizeUtf8String',\n    isFixable: false,\n    sourcePack: BEET_PACKAGE,\n    ts: 'string',\n    arg: BEET_TYPE_ARG_LEN\n  },\n  string: {\n    beet: 'utf8String',\n    isFixable: true,\n    sourcePack: BEET_PACKAGE,\n    ts: 'string'\n  }\n};","map":{"version":3,"sources":["../../../../src/beets/string.ts"],"names":[],"mappings":"AAAA,SAIE,YAJF,EAKE,iBALF,QAMO,UANP;AAOA,SAAS,MAAM,IAAI,MAAnB,QAAiC,QAAjC;AACA,SAAS,GAAT,QAAoB,WAApB;AACA,SAAS,QAAT,QAAyB,UAAzB;AAEA;;;;;;AAMG;;AACH,OAAO,MAAM,mBAAmB,GAEM,gBAAD,IAA6B;EAChE,OAAO;IACL,KAAK,EAAE,UAAU,GAAV,EAAuB,MAAvB,EAAuC,KAAvC,EAAoD;MACzD,MAAM,SAAS,GAAG,MAAM,CAAC,IAAP,CAAY,KAAZ,EAAmB,MAAnB,CAAlB;MACA,MAAM,CAAC,KAAP,CACE,SAAS,CAAC,UADZ,EAEE,gBAFF,EAGE,GAAG,KAAK,wBAHV;MAKA,GAAG,CAAC,KAAJ,CAAU,GAAV,EAAe,MAAf,EAAuB,gBAAvB;MACA,SAAS,CAAC,IAAV,CAAe,GAAf,EAAoB,MAAM,GAAG,CAA7B,EAAgC,CAAhC,EAAmC,gBAAnC;IACD,CAVI;IAYL,IAAI,EAAE,UAAU,GAAV,EAAuB,MAAvB,EAAqC;MACzC,MAAM,IAAI,GAAG,GAAG,CAAC,IAAJ,CAAS,GAAT,EAAc,MAAd,CAAb;MACA,MAAM,CAAC,KAAP,CAAa,IAAb,EAAmB,gBAAnB,EAAqC,mBAArC;MACA,MAAM,WAAW,GAAG,GAAG,CAAC,KAAJ,CAAU,MAAM,GAAG,CAAnB,EAAsB,MAAM,GAAG,CAAT,GAAa,gBAAnC,CAApB;MACA,OAAO,WAAW,CAAC,QAAZ,CAAqB,MAArB,CAAP;IACD,CAjBI;IAkBL,eAAe,EAAE,CAlBZ;IAmBL,MAAM,EAAE,gBAnBH;IAoBL,iBAAiB,EAAE,CApBd;IAqBL,QAAQ,EAAE,IAAI,gBArBT;IAsBL,WAAW,EAAE,kBAAkB,gBAAgB;EAtB1C,CAAP;AAwBD,CA3BM;AA6BP;;;;AAIG;;AACH,OAAO,MAAM,UAAU,GAAgC;EACrD,eAAe,CAAC,GAAD,EAAc,MAAd,EAA4B;IACzC,MAAM,GAAG,GAAG,GAAG,CAAC,IAAJ,CAAS,GAAT,EAAc,MAAd,CAAZ;IACA,QAAQ,CAAC,GAAG,KAAK,WAAW,IAAI,GAAG,GAA3B,CAAR;IACA,OAAO,mBAAmB,CAAC,GAAD,CAA1B;EACD,CALoD;;EAOrD,gBAAgB,CAAC,GAAD,EAAY;IAC1B,MAAM,GAAG,GAAG,MAAM,CAAC,IAAP,CAAY,GAAZ,EAAiB,UAA7B;IACA,OAAO,mBAAmB,CAAC,GAAD,CAA1B;EACD,CAVoD;;EAYrD,WAAW,EAAE;AAZwC,CAAhD;AA+BP;;;;;;AAMG;;AACH,OAAO,MAAM,aAAa,GAAkB;EAC1C,eAAe,EAAE;IACf,IAAI,EAAE,qBADS;IAEf,SAAS,EAAE,KAFI;IAGf,UAAU,EAAE,YAHG;IAIf,EAAE,EAAE,QAJW;IAKf,GAAG,EAAE;EALU,CADyB;EAQ1C,MAAM,EAAE;IACN,IAAI,EAAE,YADA;IAEN,SAAS,EAAE,IAFL;IAGN,UAAU,EAAE,YAHN;IAIN,EAAE,EAAE;EAJE;AARkC,CAArC","sourceRoot":"","sourcesContent":["import { BEET_PACKAGE, BEET_TYPE_ARG_LEN, } from '../types';\nimport { strict as assert } from 'assert';\nimport { u32 } from './numbers';\nimport { logTrace } from '../utils';\n/**\n * De/Serializes a UTF8 string of a particular size.\n *\n * @param stringByteLength the number of bytes of the string\n *\n * @category beet/collection\n */\nexport const fixedSizeUtf8String = (stringByteLength) => {\n    return {\n        write: function (buf, offset, value) {\n            const stringBuf = Buffer.from(value, 'utf8');\n            assert.equal(stringBuf.byteLength, stringByteLength, `${value} has invalid byte size`);\n            u32.write(buf, offset, stringByteLength);\n            stringBuf.copy(buf, offset + 4, 0, stringByteLength);\n        },\n        read: function (buf, offset) {\n            const size = u32.read(buf, offset);\n            assert.equal(size, stringByteLength, `invalid byte size`);\n            const stringSlice = buf.slice(offset + 4, offset + 4 + stringByteLength);\n            return stringSlice.toString('utf8');\n        },\n        elementByteSize: 1,\n        length: stringByteLength,\n        lenPrefixByteSize: 4,\n        byteSize: 4 + stringByteLength,\n        description: `Utf8String(4 + ${stringByteLength})`,\n    };\n};\n/**\n * De/Serializes a UTF8 string of any size.\n *\n * @category beet/collection\n */\nexport const utf8String = {\n    toFixedFromData(buf, offset) {\n        const len = u32.read(buf, offset);\n        logTrace(`${this.description}[${len}]`);\n        return fixedSizeUtf8String(len);\n    },\n    toFixedFromValue(val) {\n        const len = Buffer.from(val).byteLength;\n        return fixedSizeUtf8String(len);\n    },\n    description: `Utf8String`,\n};\n/**\n * Maps string beet exports to metadata which describes in which package it\n * is defined as well as which TypeScript type is used to represent the\n * deserialized value in JavaScript.\n *\n * @category TypeDefinition\n */\nexport const stringTypeMap = {\n    fixedSizeString: {\n        beet: 'fixedSizeUtf8String',\n        isFixable: false,\n        sourcePack: BEET_PACKAGE,\n        ts: 'string',\n        arg: BEET_TYPE_ARG_LEN,\n    },\n    string: {\n        beet: 'utf8String',\n        isFixable: true,\n        sourcePack: BEET_PACKAGE,\n        ts: 'string',\n    },\n};\n//# sourceMappingURL=string.js.map"]},"metadata":{},"sourceType":"module"}